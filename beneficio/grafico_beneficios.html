<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gr√°fica de Transacciones del Bot</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js 4 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Adaptador de fechas con date-fns incluido -->
    <script src="https://unpkg.com/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chart-scroll-container {
            overflow-x: auto;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }

        .chart-inner-wrapper {
            min-width: 1000px;
            /* ‚Üê Esto fuerza el scroll si hay pocos datos */
            width: max-content;
            /* ‚Üê Se expande si hay muchos puntos */
            height: 400px;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="container">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">An√°lisis de Transacciones del Bot</h1>

        <!-- üìä Gr√°fico acumulado -->
        <div class="chart-scroll-container">
            <div id="cumulativeWrapper" class="chart-inner-wrapper">
                <canvas id="cumulativeChart"></canvas>
            </div>
        </div>

        <!-- üìä Gr√°fico individual -->
        <div class="chart-scroll-container">
            <div id="individualWrapper" class="chart-inner-wrapper">
                <canvas id="individualChart"></canvas>
            </div>
        </div>

        <!-- üîô Bot√≥n Volver -->
        <div class="text-center mt-10">
            <a href="../index.html"
                class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-gray-600 hover:bg-gray-700 transition">
                &larr; Volver al Resumen
            </a>
        </div>
    </div>

    <script>
        // üî¢ Datos de ejemplo
        const csvData = `
fecha,ganancia_usdt,tipo,symbol,motivo_venta,timestamp
2025-07-19,-113.44,VENTA,BTCUSDT,estrategia A,2025-07-19T14:00:00
2025-07-20,814.99,VENTA,ETHUSDT,estrategia B,2025-07-20T13:00:00
2025-07-21,1274.39,VENTA,BNBUSDT,estrategia A,2025-07-21T12:00:00
2025-07-22,240.48,VENTA,XRPUSDT,estrategia B,2025-07-22T15:00:00
2025-07-23,-2854.13,VENTA,ADAUSDT,estrategia A,2025-07-23T10:00:00
`;

        // üß† Parseo
        function parseCSV(csv) {
            const [headers, ...rows] = csv.trim().split('\n').map(l => l.split(','));
            return rows.map(r => {
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = r[i].trim());
                return obj;
            });
        }

        const parsed = parseCSV(csvData).filter(r => r.tipo === 'VENTA');

        let cumulative = 0;
        const data = parsed.map(r => {
            const profit = parseFloat(r.ganancia_usdt);
            cumulative += profit;
            return {
                timestamp: new Date(r.timestamp),
                cumulative,
                individual: profit,
                symbol: r.symbol,
                reason: r.motivo_venta
            };
        });

        // üé® Chart 1: acumulado
        new Chart(document.getElementById("cumulativeChart"), {
            type: 'line',
            data: {
                labels: data.map(d => d.timestamp),
                datasets: [{
                    label: 'Beneficio Acumulado (USDT)',
                    data: data.map(d => d.cumulative),
                    fill: true,
                    borderColor: 'rgb(75,192,192)',
                    backgroundColor: 'rgba(75,192,192,0.2)',
                    tension: 0.3,
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day'
                        },
                        title: {
                            display: true,
                            text: 'Fecha'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'USDT'
                        }
                    }
                }
            }
        });

        // üé® Chart 2: individual
        new Chart(document.getElementById("individualChart"), {
            type: 'bar',
            data: {
                labels: data.map(d => d.timestamp),
                datasets: [{
                    label: 'Ganancia/P√©rdida por Operaci√≥n',
                    data: data.map(d => d.individual),
                    backgroundColor: data.map(d => d.individual > 0 ? 'rgba(75,192,192,0.8)' : 'rgba(255,99,132,0.8)'),
                    borderColor: data.map(d => d.individual > 0 ? 'rgb(75,192,192)' : 'rgb(255,99,132)'),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day'
                        },
                        title: {
                            display: true,
                            text: 'Fecha'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'USDT'
                        }
                    }
                }
            }
        });
    </script>
</body>

</html>